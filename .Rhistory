# Criação do gráfico
ggplot(media_por_ano, aes(x = ano_campeonato, y = media_gols_partida)) +
geom_line(color = "lightslateblue", size = 1) +
geom_point(color = "orange", size = 2) +
geom_smooth(method = "loess", se = FALSE, linetype = "dashed", color = "darkred") +
labs(
title = "Média de Gols por Partida por Temporada (2003
–2023)",
x = "Ano",
y = "Média de Gols por Jogo"
) +
theme_minimal()
top_visitantes
dados_limpos_a <- dados %>%
filter(ano_campeonato < 2024)
# Criar tabela de resultados com porcentagens
tabela_resultados <- dados_limpos_a %>%
# Criar variável de resultado
mutate(resultado = case_when(
gols_mandante > gols_visitante ~ "Vitória do Mandante",
gols_mandante == gols_visitante ~ "Empate",
gols_mandante < gols_visitante ~ "Vitória do Visitante",
TRUE ~ "Sem resultado"
)) %>%
# Remover casos sem resultado
filter(resultado != "Sem resultado") %>%
# Agrupar por ano e resultado
group_by(ano_campeonato, resultado) %>%
summarise(quantidade = n(), .groups = 'drop_last') %>%
# Calcular porcentagens
mutate(porcentagem = round(quantidade / sum(quantidade) * 100, 1),
apresentacao = paste0(quantidade, " (", porcentagem, "%)")) %>%
# Remover colunas auxiliares
select(-quantidade, -porcentagem) %>%
# Transformar em formato wide
pivot_wider(names_from = resultado, values_from = apresentacao) %>%
# Ordenar por ano
arrange(ano_campeonato) %>%
# Renomear coluna de ano
rename(Ano = ano_campeonato)
# Visualizar a tabela formatada
kable(tabela_resultados, align = c('l', 'c', 'c', 'c'),
caption = "Distribuição de Resultados por Ano do Campeonato Brasileiro") %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE) %>%
add_header_above(c(" " = 1, "Resultados (%)" = 3)) %>%
footnote(general = "Valores apresentados como: quantidade (porcentagem)",
general_title = "Formato:")
q()
raio = 10
espessura = 1
comprimento = 70
volume = pi * (raio - espessura)^2 * comprimento
volume
primeiraLetra = 'H'
segundaLetraUltNome = 'A'
primeiraLetra <= segundaLetraUltNome
time = 'Democr56ata'
class()
class()
class(time)
numero = substr(time)
numero = as.numeric(substr(time))
numero = as.numeric(substr(time, 7, 8))
class(numero)
time
numero
(numerico.vet = c(1, 2, 2, 3))
class(numerico.vet)
vet1 = c(10, 20, 30, 40)
vet2 = c(60, 70, 80, 90)
(vet3 = c(vet1, vet2))
(vet4 = c(vet2, vet1)
(vet4 = c(vet2, vet1))
)
(vet4 = c(vet2, vet1))
x = 1:5; y = c(2:4, 1, 2)
x
y
x == seq(1, 5, by = 1)
x
x < y
##Questão 1
#a)
seq(from = -3, to = 3, by = 1)
#b)
seq(from = 2.4, to = 10.4, by = 1)
#c)
seq(from = 1, to = 80, by = 2)
#d)
rep(x = c(4, 3, 2, 1), each = 4)
#d)
rep(x = c(4, 3, 2, 1), each = 3)
#e)
rep(x = c(1, 2, 3), times = 4)
#f)
x = c("Paraná", "São Paulo", "Minas Gerais")
x = c("Paraná", "São Paulo", "Minas Gerais")
#f)
x <- c("Paraná", "São Paulo", "Minas Gerais")
x <- c("Paraná", "São Paulo", "Minas Gerais")
x
x <- c("Paraná", "São Paulo", "Minas Gerais")
x
estados <- c("Paraná", "São Paulo", "Minas Gerais")
estados
blocos <- factor(c(rep(c("Bloco_1", "Bloco_2", "Bloco_3"), 2)[1:6],
c("Bloco_2", "Bloco_3")))
blocos
A = matrix(
+ c(i, j),
+ nrow = 10,
A = matrix(
+ nrow = 10,
A = matrix(
+ 0,
+ nrow = 10,
##Questão 2
A <- matrix(
+ 0,
+ nrow = 10,
A <- matrix(
+ 0,
+ nrow = 10,
##Questão 2
A <- matrix(0, nrow = 10, ncol = 10)
A <- matrix(0, nrow = 10, ncol = 10)
A
# Criar os vetores de índices de linhas e colunas
linhas <- 1:10
colunas <- 1:10
# Criar a matriz com outer
matriz <- outer(linhas, colunas, FUN = "*")
matriz
matriz <- matrix(0, nrow = 10, ncol = 10)  # inicializa a matriz
for(i in 1:10){
for(j in 1:10){
matriz[i,j] <- i * j
}
}
matriz
##Questão 2
A <- matrix(1:10, nrow = 10, ncol = 10, byrow = TRUE)
A
##Questão 2
A <- matrix(1:10, nrow = 10, ncol = 10)
##Questão 2
A <- matrix(1:10, nrow = 10, ncol = 10)
A
# Criar os vetores de índices de linhas e colunas
linhas <- 1:10
colunas <- 1:10
# Criar a matriz com outer
matriz <- outer(linhas, colunas, FUN = "*")
matriz
##Questão 3
x = 0:50
cols = c("x", "x^2", "exp(x)")
cont = c(x, x^2, exp(x))
(df = data.frame(cols, cont))
df
x = 0:50
cols = c("x", "x^2", "exp(x)")
cont = c(x, x^2, exp(x))
(df = data.frame(cols, cont, stringsAsFactors = TRUE))
df
##Questão 3
x = 0:50
cols = c("x", "x^2", "exp(x)")
cont = c(x, x^2, exp(x))
(df = data.frame(cols, cont, stringsAsFactors = F))
df
x = 0:50
cols = c("x", "x^2", "exp(x)")
cont = c(x, x^2, exp(x))
(df = data.frame(cols, cont, stringsAsFactors = F))
head(df)
# Criar o vetor x
x <- 0:50
# Criar o data frame
df <- data.frame(
x = x,
x2 = x^2,
exp_x = exp(x)
)
# Mostrar o data frame
head(df)
##Questão 3
x = 0:50
x = x
xQuadrado = x^2
expoX = exp(x)
(df = data.frame(x, xQuadrado, expoX, stringsAsFactors = F))
head(df)
(df = data.frame(x, x^2, expoX, stringsAsFactors = F))
x = 0:50
x = x
x^2 = x^2
##Questão 3
x = 0:50
x = x
"x^2" = x^2
expoX = exp(x)
(df = data.frame(x, x^2, expoX, stringsAsFactors = F))
head(df)
##Questão 3
x = 0:50
x = x
"x^2" = x^2
"exp(x)"= exp(x)
(df = data.frame(x, x^2, expoX, stringsAsFactors = F))
head(df)
(df = data.frame(x, x^2, exp(x), stringsAsFactors = F))
##Questão 3
x = 0:50
x = x
"x^2" = x^2
"exp(x)"= exp(x)
(df = data.frame(x, x^2, exp(x), stringsAsFactors = F))
head(df)
head(df)
#a)
n = 100
x = 1:n
sum(1/x)
#a)
n = 5
x = 1:n
sum(1/x)
#b)
n = 22
x = sum(1, 1/n, 1/(n + 20))
rep(x, 3)
#b)
n = 100
x = seq(22, by = 20, length.out(n))
#b)
n = 100
x = seq(22, by = 20, length.out = n)
1 + sum(1/x)
#b)
n = 1
x = seq(22, by = 20, length.out = n)
1 + sum(1/x)
data("ChickWeight")
head(ChickWeight)
help("subset")
frangosDieta2
frangosDieta2 = subset(ChickWeight, diet == 2, select = c(weight, Time))
frangosDieta2 = subset(ChickWeight, Diet == 2, select = c(weight, Time))
frangosDieta2
pesosTempo = subset(ChickWeight, Time == 2 && Diet == 2)
pesosTempo = subset(ChickWeight, Time == 2 && Diet == 2, select = weight)
pesosTempo = subset(ChickWeight, Diet == 2 && Time == 2, select = weight)
##Questão 5
data("ChickWeight")
head(ChickWeight)
help("subset")
frangosDieta2 = subset(ChickWeight, Diet == 2, select = c(weight, Time))
pesosTempo = subset(ChickWeight, Diet == 2 && Time == 2, select = weight)
##Questão 5
data("ChickWeight")
head(ChickWeight)
help("subset")
frangosDieta2 = subset(ChickWeight, Diet == 2, select = c(weight, Time))
pesosTempo = subset(ChickWeight, Diet == 2 && Time == 2, select = weight)
pesosTempo = subset(ChickWeight, Diet == 2 & Time == 2, select = weight)
pesosTempo
pesosTempo = subset(ChickWeight, Diet == 2 & Time == 2, select = weight)
mean(pesosTempo)
pesosTempo = subset(ChickWeight, Diet == 2 & Time == 2, select = weight)
mean(pesosTempo$weight)
library(tidyverse)
library(tidyverse)
install.packages(tidyverse)
##Extra
install.packages("tidyverse")
##Extra
library(tidyverse)
help("tidyverse")
install.packages(scales)
install.packages("scales")
View(df)
df <- readRDS("acidentes_2020_clean.rds") # Carregando o banco de dados já tratado
View(df)
x = c(0, 4, 2)
y = c(0, 3, 1)
x = c(0, 4, 2)
y = c(0, 3, 1)
sum(x>y)
x > y & x == y
(x!=y)*3<3
gc()
shiny::runApp('Métodos/Trabalho Final Atualizado')
runApp('Métodos/Trabalho Final Atualizado')
runApp('Métodos/Trabalho Final Atualizado')
shiny::runApp()
View(df_final)
df_final <- readRDS("bdTratado.rds")
View(df_final)
# --- 0. PREPARAÇÃO (Garante que está numérico para os gráficos) ---
df_app <- df_final %>%
mutate(
frequencia = as.numeric(frequencia),
var_pct_num = readr::parse_number(as.character(var_pct)),
rank_decada = as.integer(rank_decada),
rotulo_decada = case_when(
ano_fim == 1930 ~ "Antes de 1930",
TRUE ~ paste0(ano_fim - 9, "-", ano_fim)
),
# Criação de um FATOR ordenado pelo ano_fim para o eixo X
decada_label_ordenada = factor(rotulo_decada, levels = unique(rotulo_decada)[order(unique(ano_fim))])
)
View(df_app)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(tidyverse)
library(plotly)
library(DT)
library(forecast)
library(lubridate)
library(scales)
library(ggrepel)
df_final <- readRDS("bdTratado.rds")
df_app <- df_final %>%
mutate(
frequencia = as.numeric(frequencia),
var_pct_num = readr::parse_number(as.character(var_pct)),
rank_decada = as.integer(rank_decada),
rotulo_decada = case_when(
ano_fim == 1930 ~ "Antes de 1930",
TRUE ~ paste0(ano_fim - 9, "-", ano_fim)
),
decada_label_ordenada = factor(rotulo_decada, levels = unique(rotulo_decada)[order(unique(ano_fim))])
)
# 3. Filtragem baseada nos PARÂMETROS
dados_filtrados <- df_app %>%
filter(nome %in% params$nomes_selecionados) %>%
filter(ano_fim >= params$ano_inicio & ano_fim <= params$ano_fim)
# 4. Dados auxiliares para o gráfico de pizza
dados_pizza <- df_app %>%
ungroup() %>%
filter(ano_fim >= params$ano_inicio & ano_fim <= params$ano_fim) %>%
summarise(total = sum(frequencia, na.rm = TRUE)) %>%
pull(total)
df_selecionados_pizza <- dados_filtrados %>%
group_by(nome) %>%
summarise(valor = sum(frequencia, na.rm = TRUE)) %>%
arrange(desc(valor))
valor_outros <- dados_pizza - sum(df_selecionados_pizza$valor)
if (valor_outros > 0) {
df_pizza_final <- bind_rows(
df_selecionados_pizza,
tibble(nome = "Outros (Restante)", valor = valor_outros)
)
} else {
df_pizza_final <- df_selecionados_pizza
}
g <- ggplot(dados_filtrados, aes(x = ano_fim, y = frequencia, color = nome)) +
geom_line(linewidth = 1) +
geom_point(aes(text = paste0("Nome: ", nome, "<br>Década: ", rotulo_decada, "<br>Frequência: ", frequencia))) +
labs(title = "Evolução Temporal", x = "Década", y = "Total de Registros", color = "") +
theme_minimal() +
scale_x_continuous(breaks = seq(1930, 2010, 10))
ggplotly(g, tooltip = "text")
df_barras <- dados_filtrados %>%
group_by(nome) %>%
summarise(total = sum(frequencia, na.rm = TRUE)) %>%
mutate(nome = fct_reorder(nome, total))
g <- ggplot(df_barras, aes(x = total, y = nome, fill = nome)) +
geom_col() +
scale_x_continuous(labels = scales::comma_format(big.mark = ".", decimal.mark = ",")) +
labs(title = "Total Acumulado", x = "Total Acumulado", y = NULL) +
theme_minimal() +
theme(legend.position = "none")
ggplotly(g, tooltip = c("x", "y"))
dados_total <- df_app %>%
filter(ano_fim >= params$ano_inicio & ano_fim <= params$ano_fim) %>%
group_by(decada_label_ordenada) %>%
summarise(Frequencia_Total = sum(frequencia, na.rm = TRUE))
g <- ggplot(dados_total, aes(x = decada_label_ordenada, y = Frequencia_Total)) +
geom_bar(stat = "identity", fill = "#5F9EA0", alpha = 0.8) +
labs(title = "Total de Registros (Universo Completo)", x = "Período", y = "Total") +
scale_y_continuous(labels = scales::comma) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplotly(g)
g <- ggplot(dados_filtrados, aes(x = ano_fim, y = rank_decada, color = nome)) +
geom_line(linewidth = 1) +
geom_point(size = 2, aes(text = paste0("Posição: #", rank_decada))) +
scale_y_reverse() +
labs(title = "Disputa de Popularidade", x = "Década", y = "Posição no Ranking", color = "") +
theme_minimal() +
scale_x_continuous(breaks = seq(1930, 2010, 10))
ggplotly(g, tooltip = "text")
df_vel <- dados_filtrados %>%
mutate(
tipo_crescimento = ifelse(dif_abs >= 0, "Crescimento", "Queda"),
texto_tooltip = paste0("Nome: ", nome, "<br>Mudança: ", dif_abs)
)
g <- ggplot(df_vel, aes(x = ano_fim, y = dif_abs, fill = tipo_crescimento, text = texto_tooltip)) +
geom_col(position = "dodge") +
geom_hline(yintercept = 0, color = "black", linewidth = 0.5) +
scale_fill_manual(values = c("Crescimento" = "#18bc9c", "Queda" = "#e74c3c")) +
labs(title = "Velocidade (Ganho/Perda Real)", x = "Década", y = "Diferença Absoluta", fill = "") +
theme_minimal() +
scale_x_continuous(breaks = seq(1930, 2010, 10))
ggplotly(g, tooltip = "text")
cores_personalizadas <- c(scales::hue_pal()(nrow(df_pizza_final) - 1), "#d3d3d3")
plot_ly(df_pizza_final, labels = ~nome, values = ~valor, type = 'pie',
textinfo = 'label+percent',
hoverinfo = 'text',
text = ~paste(nome, '<br>Total:', scales::comma(valor, big.mark = ".")),
sort = FALSE,
marker = list(colors = cores_personalizadas, line = list(color = '#FFFFFF', width = 1))) %>%
layout(showlegend = TRUE, title = "Participação no Total")
df_vol <- df_app %>%
group_by(nome) %>%
arrange(ano_fim) %>%
mutate(var_pct = (frequencia - lag(frequencia)) / lag(frequencia)) %>%
filter(!is.na(var_pct)) %>%
summarise(volatilidade = sqrt(mean((var_pct)^2)), .groups = "drop") %>%
arrange(desc(volatilidade))
df_vol_sel <- df_vol %>% filter(nome %in% params$nomes_selecionados)
g <- ggplot(df_vol_sel, aes(x = reorder(nome, volatilidade), y = volatilidade, fill = nome)) +
geom_col() +
coord_flip() +
labs(title = "Índice de Volatilidade (Selecionados)", x = "Nome", y = "Volatilidade") +
theme_minimal() +
theme(legend.position = "none")
ggplotly(g)
df_cent <- dados_filtrados %>%
group_by(nome) %>%
summarise(centralidade = weighted.mean(ano_fim, frequencia, na.rm = TRUE))
g <- ggplot(df_cent, aes(x = centralidade, y = reorder(nome, centralidade), color = nome)) +
geom_point(size = 5) +
labs(title = "Centralidade Temporal", y = NULL, x = "Ano Médio Ponderado") +
theme_minimal() +
scale_x_continuous(breaks = seq(1930, 2010, 10))
ggplotly(g)
g <- ggplot(dados_filtrados, aes(x = ano_fim, y = frequencia, color = nome)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "Regressão Linear", x = "Ano", y = "Frequência") +
theme_minimal()
ggplotly(g)
serie_base <- dados_filtrados %>%
group_by(nome, ano_fim) %>%
summarise(freq = sum(frequencia), .groups = "drop")
lista_prev <- list()
for (nom in unique(serie_base$nome)) {
df_nome <- serie_base %>% filter(nome == nom) %>% arrange(ano_fim)
if(nrow(df_nome) > 2) {
ts_nome <- ts(df_nome$freq, start = df_nome$ano_fim[1], frequency = 1)
try({
modelo <- forecast::auto.arima(ts_nome)
previsao <- forecast::forecast(modelo, h = 2)
df_prev_nome <- tibble(
ano_fim = seq(from = max(df_nome$ano_fim) + 10, by = 10, length.out = 2),
freq = as.numeric(previsao$mean),
nome = nom
)
lista_prev[[nom]] <- df_prev_nome
}, silent = TRUE)
}
}
df_prevencao <- bind_rows(lista_prev)
g <- ggplot() +
geom_line(data = serie_base, aes(x = ano_fim, y = freq, color = nome), linewidth = 1) +
geom_line(data = df_prevencao, aes(x = ano_fim, y = freq, color = nome),
linewidth = 1, linetype = "dashed") +
labs(title = "Previsão ARIMA (2020-2030)", x = "Ano", y = "Frequência") +
theme_minimal() +
scale_x_continuous(breaks = seq(1930, 2030, 10))
ggplotly(g)
dados_filtrados %>%
select(
`Início` = ano_inicio,
Nome = nome,
Década = rotulo_decada,
Frequência = frequencia,
`Variação %` = var_pct,
Ranking = rank_decada
) %>%
datatable(options = list(pageLength = 10))
g <- ggplot(dados_filtrados, aes(x = ano_fim, y = frequencia, color = nome)) +
geom_line(linewidth = 1) +
geom_point(aes(text = paste0("Nome: ", nome, "<br>Década: ", rotulo_decada, "<br>Frequência: ", frequencia))) +
labs(title = "Evolução Temporal", x = "Década", y = "Total de Registros", color = "") +
theme_minimal() +
scale_x_continuous(breaks = seq(1930, 2010, 10))
ggplotly(g, tooltip = "text")
shiny::runApp()
